<apex:page controller="FlowAnalysisPDFController" renderAs="pdf" standardStylesheets="false" showHeader="false" sidebar="false">
<html>
<head>
    <meta charset="UTF-8"/>
    <style>
        @page {
            size: A4;
            margin: 2cm;
            @bottom-center {
                content: "Page " counter(page) " of " counter(pages);
                font-size: 10pt;
                color: #666;
            }
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 11pt;
            line-height: 1.6;
            color: #333;
        }

        h1 {
            color: #032e61;
            font-size: 24pt;
            border-bottom: 3px solid #0176d3;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        h2 {
            color: #032e61;
            font-size: 18pt;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        h3 {
            color: #0176d3;
            font-size: 14pt;
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .header-section {
            background: #f3f3f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .info-table td {
            padding: 8px;
            vertical-align: top;
        }

        .info-table td:first-child {
            font-weight: bold;
            width: 150px;
            color: #032e61;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 10pt;
        }

        .status-pass {
            background: #2e844a;
        }

        .status-partial {
            background: #f49756;
        }

        .status-fail {
            background: #c23934;
        }

        .status-pending {
            background: #666;
        }

        .severity-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            color: white;
            font-size: 9pt;
            margin-left: 10px;
        }

        .severity-high {
            background: #c23934;
        }

        .severity-medium {
            background: #f49756;
        }

        .severity-low {
            background: #2e844a;
        }

        .scorecard-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .scorecard-table th {
            background: #0176d3;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #015696;
        }

        .scorecard-table td {
            padding: 12px;
            border: 1px solid #ddd;
        }

        .scorecard-compliant {
            background: #d4edda;
        }

        .scorecard-partial {
            background: #fff3cd;
        }

        .scorecard-issue {
            background: #f8d7da;
        }

        .finding-block {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #0176d3;
            background: #f9f9f9;
            page-break-inside: avoid;
        }

        .recommendation-block {
            background: #f0f9ff;
            padding: 12px;
            margin-top: 10px;
            border-left: 3px solid #0176d3;
        }

        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
            font-size: 9pt;
            color: #666;
            text-align: center;
        }

        .analysis-content {
            margin: 20px 0;
            clear: both;
        }

        .analysis-content div {
            margin: 10px 0;
            padding: 0;
        }

        .analysis-content h1 {
            font-size: 20pt;
            margin-top: 25px;
        }

        .analysis-content h2 {
            font-size: 16pt;
            margin-top: 20px;
            page-break-after: avoid;
        }

        .analysis-content h3 {
            font-size: 13pt;
            margin-top: 15px;
            page-break-after: avoid;
        }

        .analysis-content p {
            margin: 8px 0;
            line-height: 1.5;
        }

        .analysis-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            page-break-inside: avoid;
        }

        .analysis-content table th,
        .analysis-content table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
            text-align: left;
            vertical-align: top;
        }

        .analysis-content table th {
            background: #f3f3f3;
            font-weight: bold;
            color: #032e61;
        }

        .analysis-content ul,
        .analysis-content ol {
            margin: 10px 0 10px 20px;
            padding-left: 15px;
        }

        .analysis-content li {
            margin: 5px 0;
            line-height: 1.4;
        }

        .analysis-content strong {
            color: #032e61;
            font-weight: bold;
        }

        /* Fix for nested divs with inline styles */
        .analysis-content div[style*="margin"] {
            margin: 10px 0 !important;
        }

        .analysis-content div[style*="padding"] {
            padding: 10px !important;
        }

        /* Ensure proper spacing for finding blocks */
        .analysis-content > div > div {
            margin-bottom: 15px;
            page-break-inside: avoid;
        }
    </style>
</head>
<body>
    <h1>Flow Analysis Report</h1>

    <div class="header-section">
        <table class="info-table">
            <tr>
                <td>Flow Name:</td>
                <td><strong>{!flowAnalysis.Flow_Label__c}</strong></td>
            </tr>
            <tr>
                <td>API Name:</td>
                <td>{!flowAnalysis.Flow_API_Name__c}</td>
            </tr>
            <tr>
                <td>Status:</td>
                <td>
                    <span class="status-badge status-{!LOWER(flowAnalysis.Status__c)}">
                        {!UPPER(flowAnalysis.Status__c)}
                    </span>
                </td>
            </tr>
            <tr>
                <td>Overall Score:</td>
                <td><strong>{!IF(ISBLANK(flowAnalysis.Overall_Score__c), 'N/A', TEXT(flowAnalysis.Overall_Score__c) & '%')}</strong></td>
            </tr>
            <tr>
                <td>Version:</td>
                <td>{!IF(ISBLANK(flowAnalysis.Flow_Version__c), 'N/A', TEXT(flowAnalysis.Flow_Version__c))}</td>
            </tr>
            <tr>
                <td>Last Analyzed:</td>
                <td>
                    <apex:outputText value="{0, date, MMMM d, yyyy 'at' h:mm a}">
                        <apex:param value="{!flowAnalysis.Last_Analyzed__c}" />
                    </apex:outputText>
                </td>
            </tr>
            <apex:outputPanel rendered="{!NOT(ISBLANK(flowAnalysis.Model_Name__c))}">
                <tr>
                    <td>AI Model:</td>
                    <td>{!flowAnalysis.Model_Name__c}</td>
                </tr>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!NOT(ISBLANK(flowAnalysis.Tokens_Used__c))}">
                <tr>
                    <td>Tokens Used:</td>
                    <td>{!TEXT(flowAnalysis.Tokens_Used__c)}</td>
                </tr>
            </apex:outputPanel>
        </table>
    </div>

    <div class="analysis-content">
        <apex:outputText value="{!flowAnalysis.Analysis_Report__c}" escape="false" />
    </div>

    <div class="footer">
        <p><strong>Generated by Flow AI Audit Dashboard</strong></p>
        <p>Powered by Einstein Prompt Templates | Generated on <apex:outputText value="{0, date, MMMM d, yyyy}"><apex:param value="{!NOW()}" /></apex:outputText></p>
    </div>
</body>
</html>
</apex:page>

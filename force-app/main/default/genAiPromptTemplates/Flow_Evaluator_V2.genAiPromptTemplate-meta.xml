<?xml version="1.0" encoding="UTF-8"?>
<GenAiPromptTemplate xmlns="http://soap.sforce.com/2006/04/metadata">
    <description>Enhanced Flow Evaluator that returns structured JSON for dashboard parsing</description>
    <developerName>Flow_Evaluator_V2</developerName>
    <masterLabel>Flow Evaluator V2</masterLabel>
    <templateVersions>
        <content>You are a Salesforce Flow expert. Analyze this flow {!$Input:MetadataXMLVar} based on the attached best practices framework {!$Input:KnowledgeText}.

CRITICAL: When evaluating risks, especially regarding governor limits, you must assume the flow could be triggered as part of a larger bulk transaction (e.g., a data load or API call processing 200 records) and assess the cumulative risk. Do not evaluate it only as a single-record execution.

Return your analysis in the following JSON format:
{
  "status": "Pass|Partial|Fail",
  "score": 85,
  "summary": "Brief 2-3 sentence summary of the flow's quality",
  "findings": [
    {
      "category": "Bulkification &amp; Loop Efficiency",
      "severity": "High|Medium|Low",
      "issue": "Description of the issue",
      "recommendation": "How to fix it"
    }
  ],
  "strengths": ["List of things done well"],
  "risks": ["List of potential risks"]
}

Scoring Guidelines:
- Pass (80-100): Follows all major best practices, no critical issues
- Partial (50-79): Some best practices followed, has medium severity issues
- Fail (0-49): Multiple critical issues or severe violations

Be thorough but concise. Focus on actionable feedback.</content>
        <inputs>
            <apiName>MetadataXMLVar</apiName>
            <definition>primitive://String</definition>
            <masterLabel>MetadataXMLVar</masterLabel>
            <referenceName>Input:MetadataXMLVar</referenceName>
            <required>true</required>
        </inputs>
        <inputs>
            <apiName>KnowledgeText</apiName>
            <definition>primitive://String</definition>
            <masterLabel>KnowledgeText</masterLabel>
            <referenceName>Input:KnowledgeText</referenceName>
            <required>true</required>
        </inputs>
        <primaryModel>sfdc_ai__DefaultBedrockAnthropicClaude37Sonnet</primaryModel>
        <responseFormat>JSON</responseFormat>
        <status>Published</status>
    </templateVersions>
    <type>einstein_gpt__flex</type>
    <visibility>Global</visibility>
</GenAiPromptTemplate>
